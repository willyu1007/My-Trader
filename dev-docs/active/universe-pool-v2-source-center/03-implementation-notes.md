# 03 Implementation Notes

- 2026-02-10: 创建任务包 `dev-docs/active/universe-pool-v2-source-center/`。
- 2026-02-10: 开始按 shared -> backend -> frontend 顺序实现，优先确保编译闭环与兼容接口。
- 2026-02-11: 数据来源中心 provider 文案改为保留原始 provider id（如 `tushare`），恢复“访问”主页入口，移除顶部说明文本。
- 2026-02-11: 修复运行时 API 缺失时的降级一致性：状态、阻断摘要与控件禁用逻辑统一，避免出现“顶部有阻断/摘要无阻断”的冲突显示。
- 2026-02-11: 按反馈调整 UI 交互：
  - 窗口默认尺寸改为 `1375x874`（相对原 `1100x760` 增宽 25%、增高 15%）。
  - 数据来源中心新增“全部展开/全部折叠”目录操作。
  - 右侧详情新增“一级配置/二级配置”可整体折叠展开，以及“展开一级/二级”“折叠一级/二级”快捷操作。
  - “主数据源应用到全部数据域 / 保存数据来源配置”改为“同步主数据源到全部数据域 / 保存变更”，并弱化按钮突兀感。
- 2026-02-11: 根据进一步反馈，将“左侧目录 + 右侧详情”的整块配置区域改为总面板折叠模式，支持一键折叠/展开该整块区域。
- 2026-02-11: 继续按反馈优化一级配置区域：
  - 移除“展开一级/二级”“折叠一级/二级”按钮；
  - 一级配置改为“数据源 + 令牌模式 + 域级操作”三列对齐布局；
  - 一级配置容器取消 `overflow-hidden`，修复下拉菜单显示被裁切的问题。
- 2026-02-11: 按最新交互要求调整左侧目录头部与二级行排版：
  - 移除搜索输入与“一级/二级目录”标题，仅保留筛选下拉（`全部`、`可同步`）；
  - 展开/折叠改为图标按钮，放在筛选下拉右侧，使用 `title` 提示悬停文本；
  - 一级目录下二级模块行改为“名称 + 固定宽度双状态标签”栅格，提升纵向对齐一致性。
- 2026-02-11: 继续降低“线框感”：
  - 左侧目录区、右侧详情区从边框盒改为浅色底块样式；
  - 一级/二级配置容器改为轻量面板样式；
  - 右侧“二级配置”由表格改为卡片列表布局，去除表格边框与行分割线。
- 2026-02-11: 优化顶部“主数据源 + 主令牌 + 主操作”区域的整体布局：
  - 调整为三层结构（顶部主操作 / 中部主令牌输入 / 底部状态摘要）；
  - 统一按钮最小宽度与右侧对齐规则，减少视觉跳动；
  - “已保存/有未保存变更”改为状态胶囊，提升状态可读性。
- 2026-02-11: 根据进一步交互反馈调整：
  - 区分“保存变更”和“保存主令牌”的职责文案对齐；
  - “同步主数据源到全部数据域”按钮更名为“全数据领同步”；
  - 主数据源下拉按钮高度调整为与“访问”按钮一致；
  - “已保存”改为点击保存后的 1 秒闪现，不再常驻。
- 2026-02-11: 四个核心操作按钮（全数据领同步/保存变更/测试主令牌/保存主令牌）改为统一双列栅格，保证同宽、同间距、上下行对齐。
- 2026-02-11: 按最新反馈继续简化交互层级：
  - 左侧展开/折叠控件改为轻量图标按钮，尺寸与筛选下拉一致，去除灰底按钮感；
  - 移除右侧重复域标题（如 ETF 专题）；
  - 移除右侧“一级配置”分组及其说明字段（数据源、令牌模式、当前令牌来源）；
  - 取消右侧折叠能力与整块区域折叠能力，改为常显布局。
- 2026-02-11: 补充精修：
  - 左侧“全部展开/全部折叠”改为透明图标按钮（无灰底）并保持与筛选下拉同高；
  - 右侧仅保留域级操作按钮与模块列表，移除一级配置相关表单字段与文案说明；
  - 整个左右区域取消折叠交互，稳定为始终可见。
- 2026-02-11: 按最新需求恢复一级数据域 token 配置能力（保持简化布局）：
  - 右侧域详情新增“域令牌输入 + 保存域令牌 + 清除域令牌”；
  - 恢复域令牌保存/清除动作与状态刷新联动（测试记录、就绪检查、令牌矩阵同步更新）；
  - 不回退已移除的冗余说明字段，仅补回功能入口。
- 2026-02-11: 恢复“整块一二级目录区域”折叠能力：
  - 在“数据来源中心”主体区增加整块折叠/展开按钮（收起目录区域 / 展开目录区域）；
  - 折叠时整体收起左侧目录、右侧详情与就绪摘要；
  - 左侧“全部展开/全部折叠”目录控件继续保留，右侧维持无单独折叠交互。
- 2026-02-11: 按“退回到取消一级配置前版本”回滚右侧详情结构：
  - 恢复右侧域标题与“一级配置 / 二级配置”分组；
  - 恢复一级配置字段：数据源、令牌模式、当前令牌来源；
  - 保留一级域 token 覆盖输入与保存/清除；
  - 保留整块目录区域折叠能力和左侧目录展开/折叠按钮，右侧无单独折叠。
- 2026-02-11: 左侧目录区恢复标题，并改名为“全量池目录”。
- 2026-02-11: 按最新 UI 要求继续微调目录区域交互：
  - 取消独立“收起目录区域 / 展开目录区域”按钮；
  - 将整块一二级目录区域折叠入口合并到“全量池目录”标题（标题点击折叠/展开）；
  - 移除“ 一二级目录区域已收起。”提示文案，折叠时仅保留标题行，减少空白与噪声。
- 2026-02-11: 目录头与筛选栏再次对齐优化：
  - 标题文案改为“全量数据池目录”；
  - “主令牌已配置 / 域覆盖 / 待处理阻断”三项状态挪到目录标题同一行展示；
  - 左侧筛选下拉框加宽（`w-[200px]`）；
  - “全部展开 / 全部折叠”图标按钮移动到筛选行最右侧；
  - 筛选新增“已测试”，且显式排除“不可测试（unsupported）”。
- 2026-02-11: 左侧二级行状态宽度压缩优化：
  - 二级行改为固定栅格（模块名 + 72px 同步状态 + 72px 测试状态）；
  - 状态胶囊改紧凑尺寸，文案简写为“纳入/未纳/未接、未测/通过/失败/不可”；
  - 模块名与状态补充 `title`，悬停可查看完整文案，减少截断影响。
- 2026-02-11: 继续按视觉反馈微调左侧状态展示：
  - 二级状态胶囊进一步压缩为 `h-5 + min-w-[56px] + px-1.5`；
  - 一级目录行中“未测”改为纯文本展示（无胶囊外框），其余状态保持胶囊样式。
- 2026-02-11: 右侧详情区布局与命名再收敛：
  - 去除右侧顶部重复域标题（如“股票数据”）；
  - “一级配置”更名为“子令牌配置”，并移除“当前令牌来源”说明行；
  - “二级配置”由卡片式模块列表改为统一表格行容器（表头与内容同一列模板）；
  - 移除行内“该模块尚未接入，当前不可纳入同步”等附加说明文案，仅保留状态/连通性标签与操作按钮。
- 2026-02-11: 二级模块区域继续按对齐反馈精简：
  - 去除二级模块内部额外表框；
  - 移除“二级配置”标题，表头第一列改为“二级模块”；
  - 表头（“二级模块/状态/连通性/操作”）统一加粗加黑并提升字号；
  - “操作”表头与内容改为左对齐；
  - “连通性”列增加 `?` 悬停说明，统一解释各状态含义。
- 2026-02-11: 继续微调二级表头与操作列：
  - 连通性 `?` 提示改为可换行悬浮层（`whitespace-pre-line`），提升可读性；
  - 收窄“操作”列固定宽度（`220px -> 170px`），减少列右侧留白。
- 2026-02-11: 补强“规划中模块不可纳入同步”交互约束：
  - 对 `!implemented || !syncCapable` 的模块，右侧“纳入同步”按钮强制禁用；
  - 同时将该按钮样式降为 `secondary`，避免视觉上误判为可点击；
  - onClick 增加前置守卫，避免任何绕过式触发。
- 2026-02-11: 继续执行右侧改造（先落地第 1 点与第 3 点）：
  - 右侧“子令牌配置”和二级模块表格容器纵向间距收紧，行高与间距更紧凑；
  - 右侧“测试 / 纳入同步 / 移出同步”按钮降一档尺寸（`h-8 + text-xs`）；
  - 左侧筛选（全部/可同步/已测试）逻辑复用到右侧二级模块列表，左右过滤结果保持一致；
  - 当筛选后右侧无模块时，展示“当前筛选条件下无二级模块”空态提示。
- 2026-02-11: 针对右侧对齐继续收敛（第 2 点）：
  - 去除“子令牌配置”外层框，保留内容区为无框排版；
  - 右侧区域上内边距收紧（`pt-1`），整体视觉上移，与左侧筛选顶部更接近对齐。
- 2026-02-11: 继续微调左/右对齐与左侧展开交互：
  - 右侧区域顶部内边距由 `pt-1` 调整为 `pt-2`，使“子令牌配置”与左侧筛选更接近垂直居中；
  - 左侧一级域改为“单击行仅切换选中，不自动展开/收起”；
  - 在一级域行右侧新增小三角按钮，单独负责展开/收起对应一级域。
