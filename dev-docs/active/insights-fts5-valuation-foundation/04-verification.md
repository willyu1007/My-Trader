# 04 Verification

## Automated checks
- `2026-02-26` `node -e "... create virtual table ... using fts5 ..."` (workdir=`apps/backend`)
  - Result: fail
  - Notes: `no such module: fts5`，确认当前运行时不支持 FTS5。
- `2026-02-26` `node -e "... using fts4/fts3 ..."` (workdir=`apps/backend`)
  - Result: pass
  - Notes: FTS4/FTS3 可用，验证问题仅在 FTS5 缺失。
- `2026-02-26` `pnpm -C apps/backend build`
  - Result: pass
  - Notes: backend 构建成功；`copy-sql-wasm` 已复制 wasm 到 `apps/backend/dist/sql-wasm.wasm`。
- `2026-02-26` `pnpm -C apps/backend typecheck`
  - Result: pass
  - Notes: backend 类型检查通过。
- `2026-02-26` `pnpm typecheck`
  - Result: pass
  - Notes: shared/backend/frontend 类型检查与 theme contract 均通过。
- `2026-02-26` `shasum -a 256 apps/backend/vendor/sql-wasm-fts5.wasm apps/backend/dist/sql-wasm.wasm`
  - Result: pass
  - Notes: hash 一致，确认构建产物来自 FTS5 vendor wasm。
- `2026-02-26` `node -e "... init sql.js with dist/sql-wasm.wasm ... create virtual table t using fts5 ..."` (workdir=`apps/backend`)
  - Result: pass
  - Notes: 输出 `fts5_runtime_rows 1`，确认运行时 FTS5 生效。
- `2026-02-26` `pnpm -C apps/backend verify:position-engine`
  - Result: pass
  - Notes: 业务路径冒烟通过（100 runs），未引入回归。
- `2026-02-26` `pnpm -C apps/backend verify:fts5`
  - Result: pass
  - Notes: 输出 `[verify-fts5] ok`，后续可作为回归验证入口。
- `2026-02-26` `pnpm typecheck`
  - Result: pass
  - Notes: shared/backend/frontend 类型检查通过；`apps/frontend verify:theme` 通过。
- `2026-02-26` `pnpm build`
  - Result: pass
  - Notes: shared/frontend/backend 全链路构建通过；frontend 仅有 chunk size 提示（非阻断）。
- `2026-02-26` `pnpm -C apps/backend verify:fts5`
  - Result: pass
  - Notes: 输出 `[verify-fts5] ok`，FTS5 回归通过。
- `2026-02-26` `pnpm -C apps/backend verify:fts5`（post e2e rerun）
  - Result: pass
  - Notes: 冒烟脚本与新增 tsup entry 后再次回归，输出 `[verify-fts5] ok`。
- `2026-02-26` `pnpm -C apps/backend verify:insights-e2e`
  - Result: pass
  - Notes: 输出 `[verify-insights-e2e] ok`；覆盖 scope 展开、插值、跨资产估值预览、exclusion/unexclude、FTS 命中。
- `2026-02-26` `pnpm -C apps/backend verify:insights-e2e`（lifecycle delete case）
  - Result: fail
  - Notes: FTS MATCH 关键词含 `-`（`fan-out`）触发语法解析，报错 `no such column: out`。
- `2026-02-26` `pnpm -C apps/backend verify:insights-e2e`（query 修正后）
  - Result: pass
  - Notes: 使用稳定关键词后通过，删除后 FTS 不可见断言生效。
- `2026-02-26` `pnpm typecheck`
  - Result: pass
  - Notes: 修复 `verifyInsightsE2E` 中 `UpdateInsightInput` 缺少 `title` 后通过。
- `2026-02-26` `pnpm build`
  - Result: pass
  - Notes: frontend/backend/shared 构建通过；frontend 仍有 chunk size 提示（非阻断）。
- `2026-02-26` `pnpm typecheck`（post preview-link patch）
  - Result: pass
  - Notes: 含 InsightsView 估值预览链路与 verify 脚本修复后，类型检查通过。
- `2026-02-26` `pnpm build`（post preview-link patch）
  - Result: pass
  - Notes: 全链路构建通过；frontend 仍有 chunk size 提示（非阻断）。
- `2026-02-26` `pnpm typecheck`（title dedup patch）
  - Result: pass
  - Notes: 移除重复模块/子 tab 标题后，shared/backend/frontend 类型检查与 theme contract 通过。
- `2026-02-26` `pnpm exec tsc --noEmit -p apps/frontend/tsconfig.json`（data-analysis placeholder title dedup）
  - Result: pass
  - Notes: 去除 `数据分析 ·` 占位标题前缀后，前端编译检查通过。
- `2026-02-26` `pnpm exec tsc --noEmit -p apps/frontend/tsconfig.json`（valuation-methods ui reshape）
  - Result: pass
  - Notes: 估值方法页重构（资产类型优先、版本差异简化）后前端编译检查通过。
- `2026-02-26` `pnpm typecheck`（valuation-methods ui reshape）
  - Result: pass
  - Notes: shared/backend/frontend 类型检查与 theme contract 均通过。
- `2026-02-27` `pnpm run dev:run-action:status && pnpm run dev:run-action && sleep 2 && pnpm run dev:run-action:status && pnpm run dev:run-action && pnpm run dev:run-action:stop && pnpm run dev:run-action:status`
  - Result: pass
  - Notes: Run action 新链路验证通过；后台启动可快速返回，重复触发幂等，停止与状态检查均正常。
- `2026-02-27` `pnpm dev`（startup loop reproduce）
  - Result: fail
  - Notes: 启动日志出现多次 `preload 已注入`，确认存在启动期重启抖动。
- `2026-02-27` `pnpm run dev:run-action && sleep 26 && tail -n 140 .mytrader-dev.log`
  - Result: pass
  - Notes: 修复后日志仅出现一次 `preload 已注入` / `auto-ingest scheduled`，未再复现连环启动弹窗。
- `2026-02-27` `pnpm run dev:run-action && sleep 95 && rg -n "preload 已注入|Timed out waiting|ELIFECYCLE" .mytrader-dev.log`
  - Result: fail
  - Notes: 发现 `Timed out waiting for http://localhost:5174`，同时 Vite 实际启动在 `5173`；定位到 `pnpm exec` 参数多余 `--` 导致端口参数未生效。
- `2026-02-27` `pnpm run dev:run-action && sleep 140 && rg -n "preload 已注入|Timed out waiting|ELIFECYCLE" .mytrader-dev.log`
  - Result: pass
  - Notes: 修复 `pnpm exec` 参数后，长时间运行仅 1 次 `preload 已注入`，无超时/退出。
- `2026-02-27` `echo "// restart-probe" >> apps/backend/dist/main.js && sleep 5 && rg -n "preload 已注入" .mytrader-dev.log`
  - Result: pass
  - Notes: 日志中 `preload 已注入` 从 1 次增加到 2 次，验证“改动后自动重启”仍可用，无需手动重新 Run。
- `2026-02-27` `pnpm run dev:run-action && sleep 75 && rg -n "preload 已注入|Timed out waiting|ELIFECYCLE" .mytrader-dev.log && echo "// restart-probe-2" >> apps/backend/dist/main.js && sleep 5 && rg -n "preload 已注入|Timed out waiting|ELIFECYCLE" .mytrader-dev.log && pnpm run dev:run-action:stop`
  - Result: pass
  - Notes: 长时间稳态仅 1 次 preload 注入；注入 probe 后增加为 2 次，确认“无抖动 + 改动自动重启”同时成立。
- `2026-02-27` `pnpm -C apps/backend typecheck && pnpm typecheck`
  - Result: pass
  - Notes: 改动 `dev.mjs` / `tsup.config.ts` 后，全量类型检查与 theme contract 通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（insights 双 tab + 事实草稿生成）
  - Result: pass
  - Notes: `InsightsView` 双 tab 重构、管理列表维度补充、资讯搜索预留 UI 后前端编译检查通过。
- `2026-02-27` `pnpm typecheck`（insights 双 tab round）
  - Result: pass
  - Notes: shared/backend/frontend 类型检查与 `verify:theme` 全部通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（insights 顶部 tab 迁移）
  - Result: pass
  - Notes: 顶部栏接入 `生成/管理`、`InsightsView` 改为受控 tab 后前端编译通过。
- `2026-02-27` `pnpm typecheck`（insights 顶部 tab 迁移）
  - Result: pass
  - Notes: shared/backend/frontend 类型检查与 `verify:theme` 均通过。
- `2026-02-27` `pnpm -C packages/shared build`（insight facts IPC 契约）
  - Result: pass
  - Notes: shared 类型与 IPC 渠道新增后编译通过。
- `2026-02-27` `pnpm -C apps/backend typecheck`（insight facts backend）
  - Result: pass
  - Notes: schema v8、insightService facts CRUD、ipc handlers 新增后后端类型检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（生成页事实列表化）
  - Result: pass
  - Notes: 生成页改为持久化事实列表（新增/删除/草稿生成）并移除顶部文案+刷新按钮后前端编译通过。
- `2026-02-27` `pnpm typecheck`（facts round）
  - Result: pass
  - Notes: shared/backend/frontend 类型检查与 `verify:theme` 均通过。
- `2026-02-27` `pnpm -C apps/backend verify:insights-e2e`
  - Result: fail
  - Notes: 失败于 `tsup.config.ts:23` 语法错误（`Expected ";" but found ")"`）；该错误位于既有构建配置文件，非本次 facts/UI 改动引入，故本轮未扩展修复。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（insights 去卡片化重排）
  - Result: pass
  - Notes: 生成/管理分栏 + 表格 + 详情工作区二级 tab 改造后前端编译通过。
- `2026-02-27` `pnpm -C apps/backend typecheck && pnpm -C packages/shared build`
  - Result: pass
  - Notes: UI 重排后后端与 shared 契约编译保持通过。
- `2026-02-27` `pnpm typecheck`（insights 去卡片化 round）
  - Result: pass
  - Notes: shared/backend/frontend 类型检查与 theme contract 均通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（insights 提示 3 秒淡出 + 分栏断点修正）
  - Result: pass
  - Notes: `error/notice` 自动淡出逻辑与 `md` 左右分栏断点调整后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（生成页三分区 + 事实全选批量删除）
  - Result: pass
  - Notes: 生成页重排为“事实录入/事实列表/观点草稿”三区结构，并新增全选与批量删除后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（观点草稿区去卡片外框）
  - Result: pass
  - Notes: 移除“观点草稿”外层卡片边框/圆角/背景容器后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（事实录入/资讯搜索上下分区）
  - Result: pass
  - Notes: 左侧输入区改为上下分段，并将资讯搜索按钮改为独立操作行后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（观点描述高度下调 + textarea 禁止拖拽）
  - Result: pass
  - Notes: 观点描述输入框高度收敛，并统一 `textarea` 为固定高度（`resize-none`）后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（资讯搜索按钮改名并上移到标题行）
  - Result: pass
  - Notes: “资讯搜索”区按钮文案改为“搜索”并与标题同行后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（观点草稿标签内置多选 + 日期输入同交易流水）
  - Result: pass
  - Notes: 标签输入改为内置下拉多选，日期输入改为交易流水同款 `type=date` 区间样式，且与标题同行后前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（观点草稿头部右侧对齐修正）
  - Result: pass
  - Notes: 日期区间与标签多选从“标题输入行”移至“观点草稿”标题行右侧后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（观点草稿头部控件简约化）
  - Result: pass
  - Notes: 日期区间与标签触发器去外框、改为轻量样式后，前端编译检查通过。
- `2026-02-27` `pnpm -C apps/frontend typecheck`（观点默认有效期：当前日期至一年后）
  - Result: pass
  - Notes: 生成页默认 `valid_from/valid_to` 与创建后重置逻辑更新后，前端编译检查通过。

## Manual checks
- [x] backend 运行时可创建 FTS5 virtual table
- [x] 关键词检索最小示例正常
- [x] insights FTS5 搜索（命中）自动化检查
- [x] 观点生命周期（创建/更新）自动化检查
- [x] scope materialization + exclusion 双向解绑自动化检查
- [x] valuation preview（当前值 vs 调整后值）自动化检查
- [ ] UI 手工回归（视图交互与文案口径）
