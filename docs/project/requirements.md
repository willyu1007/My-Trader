# Requirements

## Conclusions (read first)
- **Project**: MyTrader - 面向有经验的个人交易者的跨平台桌面交易工作台（本地优先），用于风险/敞口管理、决策引导、组合/资产配置管理、行情跟踪、数据记录、回测、机会发现与观点记录
- **In-scope (MUST)**:
  - 投资组合/资产配置/持仓维护（A 股/港股股票与 ETF；覆盖债券 ETF、贵金属 ETF 等高流通性风险管理品类）
  - 风险管理与敞口查看（仓位集中度、行业/板块暴露、资产类别暴露、预警）
  - 市场行情跟踪与数据拉取/记录（可回溯、带时间戳）
  - 回测（至少支持日频；支持交易成本/滑点假设）
  - 机会发现（板块跟踪、个股筛选/候选池、因子/模型基础集成）
  - 常见数据可视化（曲线/分布/对比）
  - 观点表达与研究/交易日志（可关联标的与组合，支持复盘）
- **Out-of-scope (OUT)**:
  - 自动下单/交易执行、券商直连（后续版本再评估）
  - 订阅与支付
  - 移动端（本期专注桌面端）
  - 多用户协作与组织权限体系
  - 云端同步/多设备共享（后续版本再评估）
  - 期货/期权等衍生品交易与回测
  - 高频/逐笔级别交易与超低延迟交易基础设施
- **Primary users**:
  - 具有一定经验的个人交易者（主用户）
  - 偏资产配置/ETF 轮动的个人投资者（同一人群的子画像）
  - 因子/模型驱动的个人投资者（同一人群的子画像）
- **Top user journeys**:
  - 本地账号登录并初始化本地数据仓库
  - 维护投资组合并查看敞口/风险与预警
  - 行情/板块/个股跟踪并发现候选机会
  - 运行回测并保存/对比结果
  - 记录观点/交易日志并复盘

## Goals (MUST)
- 提供统一的“交易工作台”体验：组合、风险、数据、回测、机会与观点在同一应用内闭环。
- 以本地数据为中心：默认离线可用，支持数据拉取、缓存、版本与回溯。
- 风险优先：在任何“建议/机会”呈现时，同屏展示敞口、集中度与限制规则。
- 可解释与可复盘：任何模型/因子/筛选结果，都能追溯输入数据与参数，且可保存为研究记录。

## Non-goals (OUT)
- 不作为交易执行终端（不做自动交易/下单），除非未来明确引入券商集成。
- 不承诺提供投资建议或收益保证；“决策引导”以流程化检查清单和信息组织为主。
- 不构建云端社交或内容平台（后续如需要再单独立项）。

## Users and user journeys
### User types
- 主用户：有经验的个人交易者（自主管理组合、策略与风险）
- 非目标用户：
  - 完全新手（需要教学导向产品）
  - 机构团队（需要多角色协作、权限与审计合规）

### Top journeys (with acceptance criteria)
1. Journey: 本地账号登录并初始化本地数据仓库
   - Acceptance criteria:
     - [ ] 支持创建本地账号（用户名+密码）并登录
     - [ ] 未登录状态无法访问本地数据（至少在 UI 层隔离）
     - [ ] 支持锁定/退出登录；再次进入需要重新解锁
     - [ ] 支持选择数据存储位置（默认使用应用数据目录）

2. Journey: 维护投资组合并查看敞口/风险与预警
   - Acceptance criteria:
     - [ ] 支持创建/重命名/归档投资组合
     - [ ] 支持为股票/ETF 添加与更新持仓（数量、成本、建仓日期等）
     - [ ] 展示资产配置与暴露：标的/行业(或板块)/资产类别维度的占比与集中度
     - [ ] 支持配置风险限制（例如单一标的上限、行业上限、现金占比区间）
     - [ ] 当限制触发时，提供明确的提示与触发原因（可追溯到计算口径）

3. Journey: 行情/板块/个股跟踪并发现候选机会
   - Acceptance criteria:
     - [ ] 支持自定义自选列表与板块/主题列表（可手动维护）
     - [ ] 展示行情快照（最新价、涨跌幅、成交额等，字段可配置）
     - [ ] 支持候选池/筛选：按基础条件与因子/模型输出进行过滤、排序、打分
     - [ ] 每个候选机会可一键创建“观点/研究记录”，并关联到标的/板块

4. Journey: 运行回测并保存/对比结果
   - Acceptance criteria:
     - [ ] 支持选择回测标的范围（例如自选池/板块成分/自定义列表）
     - [ ] 支持设定时间区间与频率（至少日频）
     - [ ] 支持设置交易成本与滑点假设，并写入回测记录
     - [ ] 输出并展示关键指标（年化收益、最大回撤、胜率、换手等）与曲线
     - [ ] 支持保存回测运行（参数、数据版本、结果）并进行横向对比

5. Journey: 记录观点/交易日志并复盘
   - Acceptance criteria:
     - [ ] 支持创建观点/研究条目，并关联标的/板块/组合
     - [ ] 支持标签、搜索与时间线浏览
     - [ ] 支持记录“计划/执行/复盘”三段式结构，并保留修改历史或版本
     - [ ] 支持从持仓或回测结果一键回链到相关观点与日志

## Functional requirements (MUST/SHOULD/MAY)

Use explicit requirement strength.

- MUST: 投资组合与持仓管理（股票/ETF）
  - Acceptance criteria: 支持组合/持仓的增删改查；按最新行情计算市值、盈亏与权重
- MUST: 风险管理与敞口展示
  - Acceptance criteria: 支持集中度/板块(或行业)/资产类别暴露展示；支持风险限制与触发提示
- MUST: 行情与数据拉取/记录（可回溯）
  - Acceptance criteria: 拉取并缓存行情数据；记录时间戳、数据源与口径（含复权/币种/交易日历）；支持按日期回放关键数据视图
- MUST: 回测能力（至少日频）
  - Acceptance criteria:
    - 支持基础策略/因子模型回测；可配置成本/滑点；结果可保存与对比
    - 纳入市场规则与费用税（至少覆盖 A 股涨跌停与交易费用/印花税；港股交易费用/印花税等），并在回测记录中保存费率与规则版本以支持复现
- MUST: 机会发现（板块跟踪、个股筛选/候选池）
  - Acceptance criteria: 支持候选池定义、过滤、排序/打分；支持条件组合形成“筛选配方”；每条机会可关联研究记录
- MUST: 观点表达与研究/交易日志
  - Acceptance criteria: 支持结构化字段（目标价、波动率、比例/仓位区间等）+ 具时间维度的趋势参数 + 自由文本；可关联标的/板块/组合；支持检索与复盘视图
- SHOULD: 常见因子与模型的集成（可扩展）
- SHOULD: 常见数据可视化（回测/风险/因子暴露/板块强弱等）
- SHOULD: 数据导入（例如 CSV 导入持仓、历史记录）
- SHOULD: 观点整理与归类（用于发现近似观点）
  - Acceptance criteria: 支持标签/分类；支持相似观点检索（本地优先；可选 LLM/RAG 驱动）
- MAY: 云端同步/多设备共享
- MAY: 券商接口集成与半自动下单
- MAY: 插件化策略/因子/数据源生态

## Data and integrations (high level)
- Core entities:
  - User（本地账号）
  - Portfolio / Account / Position
  - Instrument（股票/ETF）、Sector/Theme（板块/主题）
  - Market / Exchange / TradingCalendar（A 股/港股市场与交易日历）
  - FXRate（汇率，例如 CNY/HKD）
  - CorporateAction / Adjustment（分红送股、复权信息）
  - Issuer（发行主体，用于 A/H 映射与按发行主体聚合风险）
  - PriceBar / QuoteSnapshot（行情与K线数据）
  - Watchlist / Universe / ScreenerResult（自选与候选池）
  - Factor / Model / Signal（因子/模型/信号）
  - BacktestRun / BacktestMetric（回测运行与指标）
  - ThesisNote / TradeJournal（观点与日志）

### Data storage and account isolation
- MUST: 全局账号索引库仅保存账号列表、密码哈希/密钥引用、数据目录与最后登录时间，不存业务数据
- MUST: 每个账号独立业务库（SQLite），包含组合/持仓、风险规则、自选、回测结果、观点/日志、导入记录
- SHOULD: 每账号独立分析库（DuckDB）用于衍生分析，可由业务库+市场数据重建
- SHOULD: 市场/基准数据使用共享本地缓存库，跨账号复用，业务库不重复保存
- MUST: 账号切换必须关闭前一账号连接并阻断跨账号读写
- MUST NOT: 在仓库中保存 API Token/密钥；通过本地配置或系统钥匙串加载
- MAY: 后续支持账号级数据库加密；MVP 仅密码解锁
- Acceptance criteria:
  - [ ] 新建第二个账号会创建独立数据目录/DB 文件
  - [ ] 切换账号后不可访问其他账号的业务数据
  - [ ] 共享市场缓存可复用且不导致业务数据重复

- External systems:
  - 行情与基础数据提供方：
    - A 股：Tushare（主数据源；可能需要 API Token）
    - 港股/美股：AkShare（抓取/聚合；按数据源条款配置；可能需要额外来源）
    - 可选：交易所公开数据（作为补充或回退）
  - 交易日历与汇率数据源（用于跨市场估值与回测对齐）
  - 公司行为/复权数据源（分红、拆并股、复权因子等）
  - 概念/板块体系数据源（以主数据源为准；如存在多源需定义优先级）
  - 可选：经济与宏观数据源（例如利率、指数、行业成分等）

## Constraints and assumptions
- Constraints:
  - 跨平台桌面端：macOS、Windows、Linux
  - 本期仅本地登录与本地数据存储（不依赖云端服务）
  - 市场优先：A 股、港股
  - 交易范围：股票与 ETF（覆盖债券 ETF、贵金属 ETF 等高流通性风险管理品类），暂不考虑期货
  - 组合基准币种：CNY；港股资产以 HKD 计价并按汇率换算到基准币种
  - 不包含订阅与支付
- Assumptions:
  - 单机单用户为主（同一时间不会有多进程高并发写入）
  - 默认数据频率以日频为主，必要时可增量支持更高频数据
  - 本地数据库默认使用嵌入式方案（例如 SQLite）；分析型计算可考虑列式引擎（例如 DuckDB）作为补充
  - 跨市场聚合（组合估值/收益/风险）以“各市场收盘数据 + 汇率”完成；需要记录用于计算的汇率与数据时间以支持复现

## Success metrics

- 可用性：在 macOS/Windows/Linux 三端完成安装与启动，且核心流程可用（不需要额外手动部署服务）
- 体验：在常见规模数据下，组合概览与风险面板可交互且无明显卡顿（见 NFR 的延迟目标）
- 正确性：同一份输入数据与参数，回测结果可复现；关键计算（复权、成本、暴露口径）可追溯
- 可复盘：用户可以把一次机会发现、一次回测、一次观点记录串起来形成闭环，并在之后检索与复盘

## Verification
- This doc is considered complete when:
  - MUST requirements are actionable and testable.
  - Out-of-scope items are explicit.
  - Each top journey has acceptance criteria.
